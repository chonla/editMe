/**
 * editMe! - Just another edit-in-place plugin
 * Works for IE9, FF13, Chrome19, Opera 12
 * By: Chonla
 * Create Date: 6 July 2012
 * URL: http://blog.chonla.com
 */
(function(e){e.fn.editme=function(t){var n={type:"text",onSave:!1,fluid:!1,minWidth:50,maxWidth:1e3,minHeight:24,maxHeight:1e3,comfortZone:20};t=e.extend(n,t);var r=e('<input type="text" class="x_edit_me">'),i=e('<textarea class="x_edit_me"></textarea>');e(this).live("click",function(n){if(n.target!=this)return!0;n.stopPropagation(),n.preventDefault();var s=e(this);if(s.attr("x_edit")==1)return;switch(t.type){case"text":var o=s.attr("x_edit",1).text();r.blur(function(){var n=e(this),r=n.val(),i=n.parent(),u=i.attr("x_edit")==1;u?(i.removeAttr("x_edit").text(r),e.isFunction(t.onSave)&&t.onSave(s.get(0),o,r)):i.text(i.data("content"))}).keydown(function(t){switch(t.keyCode){case 13:e(this).blur();break;case 27:e(this).parent().removeAttr("x_edit"),e(this).blur();break;default:}}).val(o);if(t.fluid){var u=t.minWidth||r.width(),a=r.val(),f=e("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:r.css("fontSize"),fontFamily:r.css("fontFamily"),fontWeight:r.css("fontWeight"),letterSpacing:r.css("letterSpacing"),whiteSpace:"nowrap"}).appendTo("body"),l=function(){var n=e(this);a=n.val();var r=a.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");f.html(r);var i=f.width(),s=i+t.comfortZone>=u?i+t.comfortZone:u,o=n.width(),l=s<o&&s>=u||s>u&&s<t.maxWidth;l&&n.width(s)};r.bind("keyup keydown update focus",l)}s.data("content",o).html(r),r.focus();break;case"textarea":var o=s.attr("x_edit",1).html().replace(/<br>/g,"\n");i.blur(function(){var n=e(this),r=n.val(),i=n.parent(),u=i.attr("x_edit")==1;u?(i.removeAttr("x_edit").html(r.replace(/\n/g,"<br>")),e.isFunction(t.onSave)&&t.onSave(s.get(0),o,r)):i.html(i.data("content").replace(/\n/g,"<br>"))}).keydown(function(t){switch(t.keyCode){case 13:t.shiftKey||e(this).blur();break;case 27:e(this).parent().removeAttr("x_edit"),e(this).blur();break;default:}}).css({overflow:"auto",resize:"none"}).val(o);if(t.fluid){var u=t.minWidth||i.width(),c=t.minHeight||i.height(),a=i.val(),f=e("<tester_area/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",height:"auto",fontSize:i.css("fontSize"),fontFamily:i.css("fontFamily"),fontWeight:i.css("fontWeight"),letterSpacing:i.css("letterSpacing"),lineSpacing:i.css("lineSpacing"),whiteSpace:"nowrap"}).appendTo("body"),l=function(){var n=e(this);a=n.val();var r=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/\s/g," ");f.html(r);var i=f.width(),s=i+t.comfortZone>=u?i+t.comfortZone:u,o=n.width(),l=s<o&&s>=u||s>u&&s<t.maxWidth,h=f.height(),p=h+t.comfortZone>=c?h+t.comfortZone:c,d=n.height(),v=p<d&&p>=c||p>c&&p<t.maxHeight;l&&n.width(s),v&&n.height(p)};i.bind("keyup keydown update focus",l)}s.data("content",o).html(i),i.focus()}})}})(jQuery)